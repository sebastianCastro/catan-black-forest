function toggleControls(){const e=document.getElementById("controlPanel"),t=document.getElementById("toggleControlsButton");"none"===e.style.display?(e.style.display="block",t.textContent="Hide Map Customization Options"):(e.style.display="none",t.textContent="Show Map Customization Options")}function downloadGamePiecesPdf(e){e.preventDefault();const t=document.createElement("a");t.href="catan.pdf",t.download="catan-game-pieces.pdf",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function generateMap(){const e=document.getElementById("hexGrid");e.innerHTML="";const t=parseNumberList(document.getElementById("forestTilesInput").value),n=parseNumberList(document.getElementById("desertTilesInput").value),o=parseNumberList(document.getElementById("portTilesInput").value);let l={};try{l=JSON.parse(document.getElementById("portRotationsInput").value)}catch(e){console.error("Invalid JSON for port rotations",e)}const s=parseInt(document.getElementById("brickCount").value)||0,a=parseInt(document.getElementById("woolCount").value)||0,d=parseInt(document.getElementById("wheatCount").value)||0,r=parseInt(document.getElementById("oreCount").value)||0,i=parseInt(document.getElementById("sixesCount").value)||0,c=parseInt(document.getElementById("eightsCount").value)||0,u={1:[2,6,7],2:[1,3,7,8],3:[2,4,8,9],4:[3,5,9,10],5:[4,10,11],6:[7,12,13],7:[1,6,8,13,14],8:[1,2,7,9,14,15],9:[2,3,8,10,15,16],10:[3,4,9,11,16,17],11:[4,5,10,17,18],12:[13,19,20],13:[6,12,14,20,21],14:[6,7,13,15,21,22],15:[7,8,14,16,22,23],16:[8,9,15,17,23,24],17:[9,10,16,18,24,25],18:[10,11,17,25,26],19:[20,27,28],20:[12,19,21,28,29],21:[12,13,20,22,29,30],22:[13,14,21,23,30,31],23:[14,15,22,24,31,32],24:[15,16,23,25,32,33],25:[16,17,24,26,33,34],26:[17,18,25,34,35],27:[28,36],28:[19,27,29,36,37],29:[19,20,28,30,37,38],30:[20,21,29,31,38,39],31:[21,22,30,32,39,40],32:[22,23,31,33,40,41],33:[23,24,32,34,41,42],34:[24,25,33,35,42,43],35:[25,26,34,43],36:[27,37,44],37:[27,28,36,38,44,45],38:[28,29,37,39,45,46],39:[29,30,38,40,46,47],40:[30,31,39,41,47,48],41:[31,32,40,42,48,49],42:[32,33,41,43,49,50],43:[33,34,42,50],44:[36,45,51],45:[36,37,44,46,51,52],46:[37,38,45,47,52,53],47:[38,39,46,48,53,54],48:[39,40,47,49,54,55],49:[40,41,48,50,55,56],50:[41,42,49,56],51:[44,52,57],52:[44,45,51,53,57,58],53:[45,46,52,54,58,59],54:[46,47,53,55,59,60],55:[47,48,54,56,60,61],56:[48,49,55,61],57:[51,58],58:[51,52,57,59],59:[52,53,58,60],60:[53,54,59,61],61:[54,55,60]};function m(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}const p=[...Array(c).fill(8),...Array(i).fill(6)];m(p);let h={},f=m([...t]);p.forEach((e=>{const t=f.filter((e=>!(u[e]||[]).some((e=>6===h[e]||8===h[e]))));if(t.length>0){const n=t[Math.floor(Math.random()*t.length)];h[n]=e,f=f.filter((e=>e!==n))}else{const t=f.pop();t&&(h[t]=e)}}));const g=m([2,3,3,4,4,4,4,5,5,5,5,9,9,9,9,10,10,10,10,10,11,11,12,12]);f.forEach(((e,t)=>{t<g.length?h[e]=g[t]:(h[e]=Math.floor(11*Math.random())+2,7===h[e]&&(h[e]=6))}));const y=[];for(let e=1;e<=61;e++)n.includes(e)||o.includes(e)||t.includes(e)||y.push(e);const E=m([2,2,3,3,3,4,4,4,4,5,5,5,5,6,6,6,8,8,8,9,9,9,10,10,10,10,11,11,11,12]).slice(0,y.length),I=parseInt(document.getElementById("desertFogCount").value)||0,v=[...Array(s).fill("brick"),...Array(a).fill("wool"),...Array(d).fill("wheat"),...Array(r).fill("ore"),...Array(I).fill("desert")];for(;v.length<y.length;){const e=["brick","wool","wheat","ore"];v.push(e[Math.floor(Math.random()*e.length)])}const C=m(v).slice(0,y.length),B={},L={};y.forEach(((e,t)=>{B[e]=C[t],"desert"===C[t]?L[e]=null:L[e]=E[t]}));let b=1;[5,6,7,8,9,8,7,6,5].forEach(((s,a)=>{const d=document.createElement("div");d.classList.add("hex-row");for(let e=0;e<s;e++){const e=document.createElement("div");e.className="hex";const s=b++,a=document.createElement("div");if(a.className="hex-number",n.includes(s))e.classList.add("desert");else if(o.includes(s))e.classList.add("wood-port"),void 0!==l[s]&&e.style.setProperty("--rotation",`${l[s]}deg`);else if(t.includes(s)){e.classList.add("forest");const t=h[s];t&&(a.textContent=t,6!==t&&8!==t||a.classList.add("red"),e.appendChild(a))}else if(e.classList.add("gray"),e.dataset.terrain=B[s],e.dataset.number=L[s],null!==L[s]){const t=document.createElement("div");t.className="hex-number hidden-number",t.textContent=L[s],6!==L[s]&&8!==L[s]||t.classList.add("red"),e.appendChild(t),t.style.display="none"}d.appendChild(e),e.addEventListener("click",(function(){if(this.classList.contains("gray")&&this.dataset.terrain){this.classList.remove("gray"),this.classList.add(this.dataset.terrain);const e=this.querySelector(".hidden-number");e&&(e.style.display="block")}}))}e.appendChild(d)}))}function parseNumberList(e){return e.split(",").map((e=>e.trim())).filter((e=>""!==e)).map((e=>parseInt(e))).filter((e=>!isNaN(e)))}document.getElementById("generateButton").addEventListener("click",generateMap),document.getElementById("toggleControlsButton").addEventListener("click",toggleControls),document.getElementById("downloadPdfButton").addEventListener("click",downloadGamePiecesPdf),generateMap();